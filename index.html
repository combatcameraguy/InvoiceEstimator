<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COMCAM Quote Request</title>
    
    <!-- PWA Metadata -->
    <meta name="description" content="Request a quote for professional video production services">
    <meta name="theme-color" content="#2a5298">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="COMCAM Quote">
    
    <!-- html2pdf.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 950px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: #2a5298;
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .content {
            padding: 30px;
        }
        
        .info-banner {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border: 2px solid #2a5298;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .info-banner h3 {
            color: #1e3c72;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .info-banner p {
            color: #1e3c72;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 8px;
        }
        
        .info-banner p:last-child {
            margin-bottom: 0;
        }
        
        .disclaimer {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 25px;
        }
        
        .disclaimer p {
            color: #856404;
            font-size: 13px;
            line-height: 1.6;
            margin: 0;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #2a5298;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #2a5298;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 15px;
        }
        
        label .required {
            color: #e74c3c;
        }
        
        label .price-note {
            font-weight: normal;
            color: #666;
            font-size: 13px;
        }
        
        select, input[type="number"], input[type="text"], input[type="email"], textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 15px;
            transition: border-color 0.3s;
            font-family: inherit;
        }
        
        textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: #2a5298;
        }
        
        select:disabled, input:disabled {
            background-color: #e9ecef;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        small {
            color: #666;
            font-size: 12px;
            display: block;
            margin-top: 5px;
        }
        
        .checkbox-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 8px;
            background: white;
            border-radius: 6px;
        }
        
        .checkbox-item.disabled {
            opacity: 0.5;
            pointer-events: none;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            cursor: pointer;
        }
        
        .checkbox-item label {
            margin: 0;
            font-weight: normal;
            cursor: pointer;
        }
        
        .sub-input {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border: 2px solid #e0e0e0;
        }
        
        .price-display {
            background: #2a5298;
            color: white;
            padding: 25px;
            border-radius: 8px;
            text-align: center;
            margin: 30px 0;
        }
        
        .price-label {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .price-amount {
            font-size: 48px;
            font-weight: bold;
        }
        
        .itemized-list {
            background: #f8f9fa;
            border: 2px solid #2a5298;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .itemized-list h3 {
            color: #2a5298;
            font-size: 18px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #2a5298;
        }
        
        .itemized-list .item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .itemized-list .item:last-child {
            border-bottom: none;
        }
        
        .itemized-list .item-name {
            color: #333;
            font-size: 14px;
        }
        
        .itemized-list .item-price {
            color: #2a5298;
            font-weight: 600;
            font-size: 14px;
        }
        
        .itemized-list .no-items {
            text-align: center;
            color: #999;
            font-style: italic;
            padding: 20px;
        }
        
        .button-group {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 30px;
        }
        
        .btn {
            padding: 15px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #2a5298;
            color: white;
        }
        
        .btn-primary:hover {
            background: #1e3c72;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .success-message,
        .error-message {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .success-message.show,
        .error-message.show {
            display: block;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé¨ COMCAM Video Production</h1>
            <p>Request a custom quote for your project</p>
        </div>
        
        <div class="content">
            <div class="info-banner">
                <h3>üì¶ Filming Services Include Free Hard Drive!</h3>
                <p><strong>When you book filming services</strong>, we'll provide all raw 4K footage on a complimentary hard drive at no extra cost. This ensures you have full access to all source materials from your shoot.</p>
            </div>
            
            <div class="disclaimer">
                <p>‚ö†Ô∏è <strong>Important:</strong> All quote requests go through a consultation process for verification of services and project planning. This ensures we fully understand your needs and can deliver the best results for your project.</p>
            </div>
            
            <div id="successMessage" class="success-message">
                <strong>‚úì Quote Request Submitted!</strong><br>
                We've received your request and will review it shortly. Expect to hear from us soon!
            </div>
            
            <div id="errorMessage" class="error-message">
                <strong>‚úó Submission Error</strong><br>
                <span id="errorText">Something went wrong. Please try again.</span>
            </div>
            
            <form id="quoteForm">
                <!-- Client Information -->
                <div class="section">
                    <div class="section-title">üìã Your Information</div>
                    
                    <div class="form-group">
                        <label>Name <span class="required">*</span></label>
                        <input type="text" id="clientName" required placeholder="Your name or company">
                    </div>
                    
                    <div class="form-group">
                        <label>Email <span class="required">*</span></label>
                        <input type="email" id="clientEmail" required placeholder="your@email.com">
                    </div>
                    
                    <div class="form-group">
                        <label>Project Title <span class="required">*</span></label>
                        <input type="text" id="projectName" required placeholder="Brief title for your project">
                    </div>
                    
                    <div class="form-group">
                        <label>Project Description</label>
                        <textarea id="projectDescription" placeholder="Tell us about your project..."></textarea>
                    </div>
                </div>
                
                <!-- Timeline Editing -->
                <div class="section">
                    <div style="display: flex; align-items: start; gap: 15px; margin-bottom: 20px;">
                        <input type="checkbox" id="timelineEditingEnabled" style="width: 24px; height: 24px; margin-top: 4px; cursor: pointer;">
                        <div style="flex: 1;">
                            <label for="timelineEditingEnabled" style="cursor: pointer; margin: 0; font-size: 18px; font-weight: 600; color: #2a5298; display: block;">
                                ‚úÇÔ∏è Timeline Editing
                            </label>
                            <p style="margin: 5px 0 0 0; color: #666; font-size: 14px;">
                                Check this box if you need video editing services (otherwise it's filming + file transfer only)
                            </p>
                        </div>
                    </div>
                    
                    <div id="timelineEditingFields" style="display: none;">
                        <div class="form-group">
                            <label>Final Video Duration</label>
                            <input type="number" id="duration" min="0.5" max="180" value="1.0" step="0.5">
                            <small>Tiered pricing: Under 1 min = $100/min | 1-5 min = $60/min | 5+ min = $40/min</small>
                        </div>
                    </div>
                </div>
                
                <!-- Fast Lane / Priority Service -->
                <div style="background: linear-gradient(135deg, #ffc107 0%, #ffeb3b 100%); padding: 20px; border-radius: 8px; margin-bottom: 30px; border: 2px solid #f9a825;">
                    <div style="display: flex; align-items: start; gap: 15px;">
                        <input type="checkbox" id="fastLane" style="width: 24px; height: 24px; margin-top: 4px; cursor: pointer;">
                        <div style="flex: 1;">
                            <label for="fastLane" style="cursor: pointer; margin: 0; font-size: 18px; font-weight: 700; color: #333; display: block; margin-bottom: 8px;">
                                ‚ö° Fast Lane / Priority Service <span style="font-weight: normal; font-size: 14px;">(+30% to total)</span>
                            </label>
                            <p style="margin: 0; color: #666; font-size: 14px; line-height: 1.6;">
                                <strong>RUSH DELIVERY</strong> for videos 2 minutes or less. MOVE to the FRONT of the production line and get your project completed FASTER!
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Video Production Services -->
                <div class="section">
                    <div class="section-title">üé¨ Filming/Production (Optional)</div>
                    
                    <div class="form-group">
                        <label>Filming Services</label>
                        <select id="filmingRateType">
                            <option value="none">None - Post-Production Only</option>
                            <option value="hourly">Hourly Rate</option>
                            <option value="daily">Full-Day Bulk Rate (8+ hours)</option>
                        </select>
                        <small>Choose "None" if you're providing your own footage</small>
                    </div>
                    
                    <div id="filmingDetails" style="display: none;">
                        <div class="form-group" id="filmingDurationGroup">
                            <label id="filmingDurationLabel">Filming Duration (hours) <span class="price-note" id="filmingPriceNote"></span></label>
                            <input type="number" id="filmingDuration" min="2" max="24" value="2" step="0.5">
                            <small id="filmingDurationHint">‚≠ê 2-hour minimum: 1 hour setup + 1 hour filming</small>
                        </div>
                        
                        <div class="form-group">
                            <label>Location Type</label>
                            <select id="filmingLocation">
                                <option value="studio">Studio/Controlled Environment</option>
                                <option value="indoor">Indoor Location</option>
                                <option value="outdoor" selected>Outdoor Location</option>
                                <option value="multiple">Multiple Locations</option>
                            </select>
                            <small id="locationPriceNote">Studio: $150/hr or $1000/day | Indoor: $180/hr or $1200/day | Outdoor: $200/hr or $1400/day | Multiple: $220/hr or $1600/day</small>
                        </div>
                        
                        <div class="form-group">
                            <label>Raw Footage Minutes <span class="price-note">(For file size estimation)</span></label>
                            <input type="number" id="rawFootageMinutes" min="1" max="600" value="10" step="1">
                            <small>Estimated minutes of raw footage to calculate file transfer fee</small>
                        </div>
                        
                        <div class="info-banner">
                            <h3>üìÅ Sony FX6 4K File Size Reference</h3>
                            <p><strong>1 minute:</strong> ~3-5 GB (avg 4 GB)</p>
                            <p><strong>5 minutes:</strong> ~15-25 GB (avg 20 GB)</p>
                            <p><strong>10 minutes:</strong> ~30-50 GB (avg 40 GB)</p>
                            <p><strong>30 minutes:</strong> ~90-150 GB (avg 120 GB)</p>
                            <p style="margin-top: 10px; font-size: 12px; opacity: 0.8;">
                                <em>Note: If Final Video Duration is set to 0, a small file transfer fee will be added to cover storage and secure delivery. Transfer fee: $25 base + $25 per 100GB.</em>
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Post-Production -->
                <div class="section" id="postProductionSection">
                    <div class="section-title">‚ú® Post-Production Services</div>
                    
                    <div class="checkbox-group">
                        <div class="checkbox-item" id="basicColorItem">
                            <input type="checkbox" id="basicColor">
                            <label for="basicColor">Basic Color Correction <span style="font-size: 12px; color: #666;">($200)</span></label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="advancedColor">
                            <label for="advancedColor">Advanced Color Grading <span style="font-size: 12px; color: #666;">($500)</span></label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="fxWork">
                            <label for="fxWork">FX/Masking/Roto <span style="font-size: 12px; color: #666;">($400)</span></label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="motionGraphics">
                            <label for="motionGraphics">Motion Graphics <span style="font-size: 12px; color: #666;">(Varies)</span></label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="audioMixing">
                            <label for="audioMixing">Audio Mixing <span style="font-size: 12px; color: #666;">($45/min)</span></label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="soundDesign">
                            <label for="soundDesign">Sound Design/SFX (Library) <span style="font-size: 12px; color: #666;">($150)</span></label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="musicComposition">
                            <label for="musicComposition">Music Composition/Jingle (Custom) <span style="font-size: 12px; color: #666;">(Varies)</span></label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="voiceover">
                            <label for="voiceover">Voiceover/Narration <span style="font-size: 12px; color: #666;">($300 base)</span></label>
                        </div>
                    </div>
                    
                    <!-- Motion Graphics Details -->
                    <div id="graphicsDetails" class="sub-input" style="display:none;">
                        <div class="form-group">
                            <label for="graphicsDuration">Total Graphics Duration (seconds)</label>
                            <input type="number" id="graphicsDuration" min="1" max="600" value="10" step="1">
                            <small>Total screen time of all graphics/animations</small>
                        </div>
                        <div class="form-group">
                            <label for="graphicsComplexity">Graphics Type</label>
                            <select id="graphicsComplexity">
                                <option value="simple" selected>Simple - Text animations, lower thirds ($15/sec)</option>
                                <option value="moderate">Moderate - Logos, icons, transitions ($35/sec)</option>
                                <option value="complex">Complex - Full animations, 3D ($65/sec)</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Music Composition Details -->
                    <div id="musicDetails" class="sub-input" style="display:none;">
                        <div class="form-group">
                            <label for="musicType">Custom Music Type</label>
                            <select id="musicType">
                                <option value="jingle" selected>Jingle Creation ($500)</option>
                                <option value="bed">Music Bed Creation - Looping with Stinger ($200)</option>
                            </select>
                            <small>Jingle creation includes more complex composition and copyright clearance</small>
                        </div>
                    </div>
                    
                    <!-- Voiceover Details -->
                    <div id="voiceoverDetails" class="sub-input" style="display:none;">
                        <div class="form-group">
                            <label for="voiceoverCoverage">Voiceover Coverage</label>
                            <select id="voiceoverCoverage">
                                <option value="full" selected>Full Coverage (100% of video duration)</option>
                                <option value="partial">Partial Coverage (50% of video duration)</option>
                            </select>
                            <small>Pricing is based on the final video duration</small>
                        </div>
                    </div>
                </div>
                
                <!-- Itemized List -->
                <div class="itemized-list">
                    <h3>üìã Your Selected Services</h3>
                    <div id="itemizedListContent">
                        <div class="no-items">Select services above to see itemized pricing</div>
                    </div>
                </div>
                
                <!-- Price Display -->
                <div class="price-display">
                    <div class="price-label">Estimated Quote</div>
                    <div class="price-amount">$<span id="totalPrice">0</span></div>
                </div>
                
                <!-- Action Buttons -->
                <div class="button-group">
                    <button type="submit" class="btn btn-primary" id="submitBtn">Submit Request</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // API Configuration
        const API_URL = 'http://localhost:3001';
        
        // ========== FIREBASE CONFIGURATION ==========
        const firebaseConfig = {
            apiKey: "AIzaSyDSLjUPp5hBk6DQnrIGL4iWDUNJC-YVXoY",
            authDomain: "comcam-dashboard.firebaseapp.com",
            databaseURL: "https://comcam-dashboard-default-rtdb.firebaseio.com",
            projectId: "comcam-dashboard",
            storageBucket: "comcam-dashboard.firebasestorage.app",
            messagingSenderId: "102412134495",
            appId: "1:102412134495:web:0cd510265df617e99093ea"
        };

        //Initialize Firebase
        let database;
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            console.log('‚úÖ Firebase initialized');
        } catch (error) {
            console.error('‚ùå Firebase error:', error);
        }
        
        // Show/hide motion graphics details
        document.getElementById('motionGraphics').addEventListener('change', function() {
            document.getElementById('graphicsDetails').style.display = this.checked ? 'block' : 'none';
            updateItemizedList();
            calculatePrice();
        });
        
        // Show/hide music composition details
        document.getElementById('musicComposition').addEventListener('change', function() {
            document.getElementById('musicDetails').style.display = this.checked ? 'block' : 'none';
            updateItemizedList();
            calculatePrice();
        });
        
        // Show/hide timeline editing fields
        document.getElementById('timelineEditingEnabled').addEventListener('change', function() {
            document.getElementById('timelineEditingFields').style.display = this.checked ? 'block' : 'none';
            updateItemizedList();
            calculatePrice();
        });
        
        // Show/hide voiceover details
        document.getElementById('voiceover').addEventListener('change', function() {
            document.getElementById('voiceoverDetails').style.display = this.checked ? 'block' : 'none';
            updateItemizedList();
            calculatePrice();
        });
        
        // Show/hide filming details based on rate type
        document.getElementById('filmingRateType').addEventListener('change', function() {
            const filmingDetails = document.getElementById('filmingDetails');
            const filmingDuration = document.getElementById('filmingDuration');
            const filmingDurationLabel = document.getElementById('filmingDurationLabel');
            const filmingDurationHint = document.getElementById('filmingDurationHint');
            const filmingPriceNote = document.getElementById('filmingPriceNote');
            
            if (this.value === 'none') {
                filmingDetails.style.display = 'none';
            } else if (this.value === 'daily') {
                filmingDetails.style.display = 'block';
                filmingDurationLabel.innerHTML = 'Filming Duration (days) <span class="price-note" id="filmingPriceNote">(See rates below)</span>';
                filmingDuration.min = '1';
                filmingDuration.value = '1';
                filmingDuration.step = '1';
                filmingDurationHint.textContent = '‚≠ê Full day rate (8+ hours of filming)';
            } else {
                filmingDetails.style.display = 'block';
                filmingDurationLabel.innerHTML = 'Filming Duration (hours) <span class="price-note" id="filmingPriceNote">(See rates below)</span>';
                filmingDuration.min = '2';
                filmingDuration.value = '2';
                filmingDuration.step = '0.5';
                filmingDurationHint.textContent = '‚≠ê 2-hour minimum: 1 hour setup + 1 hour filming';
            }
            
            updateItemizedList();
            calculatePrice();
        });
        
        // Handle advanced color grading selection - grey out basic color correction
        document.getElementById('advancedColor').addEventListener('change', function() {
            const basicColorItem = document.getElementById('basicColorItem');
            const basicColorCheckbox = document.getElementById('basicColor');
            
            if (this.checked) {
                basicColorItem.classList.add('disabled');
                basicColorCheckbox.disabled = true;
                basicColorCheckbox.checked = false;
            } else {
                basicColorItem.classList.remove('disabled');
                basicColorCheckbox.disabled = false;
            }
            
            updateItemizedList();
            calculatePrice();
        });
        
        // Update itemized list
        function updateItemizedList() {
            const items = [];
            let total = 0;
            
            const timelineEditingEnabled = document.getElementById('timelineEditingEnabled').checked;
            const duration = timelineEditingEnabled ? (parseFloat(document.getElementById('duration').value) || 0) : 0;
            
            // Check if any post-production services are selected
            const hasPostProduction = duration > 0 || 
                document.getElementById('basicColor').checked ||
                document.getElementById('advancedColor').checked ||
                document.getElementById('fxWork').checked ||
                document.getElementById('motionGraphics').checked ||
                document.getElementById('audioMixing').checked ||
                document.getElementById('soundDesign').checked ||
                document.getElementById('musicComposition').checked ||
                document.getElementById('voiceover').checked;
            
            // Check if this is file transfer only (filming but no post-production)
            const filmingRateType = document.getElementById('filmingRateType').value;
            const isFilming = filmingRateType !== 'none';
            const isFileTransferOnly = isFilming && !hasPostProduction;
            
            if (duration > 0) {
                // Tiered pricing for editing
                let editCost = 0;
                let rateDescription = '';
                
                if (duration < 1) {
                    editCost = duration * 100;
                    rateDescription = `Base Video Edit (${duration} min @ $100/min)`;
                } else if (duration <= 5) {
                    editCost = duration * 60;
                    rateDescription = `Base Video Edit (${duration} min @ $60/min)`;
                } else {
                    editCost = duration * 40;
                    rateDescription = `Base Video Edit (${duration} min @ $40/min)`;
                }
                
                items.push({ name: rateDescription, price: editCost });
                total += editCost;
            }
            
            // Filming services
            if (filmingRateType !== 'none') {
                const filmingDuration = parseFloat(document.getElementById('filmingDuration').value) || 0;
                const filmingLocation = document.getElementById('filmingLocation').value;
                
                if (filmingRateType === 'daily') {
                    const dailyRates = {
                        studio: 1000,
                        indoor: 1200,
                        outdoor: 1400,
                        multiple: 1600
                    };
                    const locationNames = {
                        studio: 'Studio',
                        indoor: 'Indoor',
                        outdoor: 'Outdoor',
                        multiple: 'Multiple Locations'
                    };
                    const filmingCost = filmingDuration * dailyRates[filmingLocation];
                    items.push({ name: `Filming - ${locationNames[filmingLocation]} (${filmingDuration} day${filmingDuration > 1 ? 's' : ''} @ $${dailyRates[filmingLocation]}/day)`, price: filmingCost });
                    total += filmingCost;
                } else if (filmingRateType === 'hourly') {
                    const hourlyRates = {
                        studio: 150,
                        indoor: 180,
                        outdoor: 200,
                        multiple: 220
                    };
                    const locationNames = {
                        studio: 'Studio',
                        indoor: 'Indoor',
                        outdoor: 'Outdoor',
                        multiple: 'Multiple Locations'
                    };
                    const filmingCost = filmingDuration * hourlyRates[filmingLocation];
                    items.push({ name: `Filming - ${locationNames[filmingLocation]} (${filmingDuration} hrs @ $${hourlyRates[filmingLocation]}/hr)`, price: filmingCost });
                    total += filmingCost;
                }
                
                // File transfer fee (only if no editing)
                if (isFileTransferOnly) {
                    const rawFootageMinutes = parseFloat(document.getElementById('rawFootageMinutes').value) || 0;
                    const estimatedGB = rawFootageMinutes * 4; // avg 4GB per minute
                    const transferFee = 25 + (Math.floor(estimatedGB / 100) * 25);
                    items.push({ name: `File Transfer Fee (~${Math.round(estimatedGB)}GB: $25 base + $25 per 100GB)`, price: transferFee });
                    total += transferFee;
                }
            }
            
            // Post-production add-ons
            if (document.getElementById('basicColor').checked) {
                items.push({ name: 'Basic Color Correction', price: 200 });
                total += 200;
            }
            if (document.getElementById('advancedColor').checked) {
                items.push({ name: 'Advanced Color Grading', price: 500 });
                total += 500;
            }
            if (document.getElementById('fxWork').checked) {
                items.push({ name: 'FX/Masking/Roto', price: 400 });
                total += 400;
            }
            if (document.getElementById('audioMixing').checked) {
                const audioMixCost = duration * 45;
                items.push({ name: `Audio Mixing (${duration} min @ $45/min)`, price: audioMixCost });
                total += audioMixCost;
            }
            if (document.getElementById('soundDesign').checked) {
                items.push({ name: 'Sound Design/SFX (Library)', price: 150 });
                total += 150;
            }
            
            // Music composition
            if (document.getElementById('musicComposition').checked) {
                const musicType = document.getElementById('musicType').value;
                const musicCost = musicType === 'jingle' ? 500 : 200;
                const musicName = musicType === 'jingle' ? 'Jingle Creation' : 'Music Bed Creation';
                items.push({ name: musicName, price: musicCost });
                total += musicCost;
            }
            
            // Voiceover - adjusted to video duration
            if (document.getElementById('voiceover').checked) {
                const voiceoverCoverage = document.getElementById('voiceoverCoverage').value;
                let voiceoverCost;
                if (voiceoverCoverage === 'full') {
                    voiceoverCost = duration * 300; // $300 per minute for full coverage
                    items.push({ name: `Voiceover/Narration - Full Coverage (${duration} min @ $300/min)`, price: voiceoverCost });
                } else {
                    const partialDuration = duration * 0.5;
                    voiceoverCost = partialDuration * 300; // $300 per minute for partial
                    items.push({ name: `Voiceover/Narration - Partial Coverage (${partialDuration.toFixed(1)} min @ $300/min)`, price: voiceoverCost });
                }
                total += voiceoverCost;
            }
            
            // Motion graphics
            if (document.getElementById('motionGraphics').checked) {
                const graphicsDuration = parseInt(document.getElementById('graphicsDuration').value) || 0;
                const graphicsComplexity = document.getElementById('graphicsComplexity').value;
                const rates = { simple: 15, moderate: 35, complex: 65 };
                const complexityNames = { simple: 'Simple', moderate: 'Moderate', complex: 'Complex' };
                const graphicsCost = graphicsDuration * rates[graphicsComplexity];
                items.push({ name: `Motion Graphics - ${complexityNames[graphicsComplexity]} (${graphicsDuration} sec @ $${rates[graphicsComplexity]}/sec)`, price: graphicsCost });
                total += graphicsCost;
            }
            
            // Fast Lane / Priority Service
            let fastLaneMultiplier = 1;
            if (document.getElementById('fastLane').checked) {
                fastLaneMultiplier = 1.30;
                const fastLaneCost = total * 0.30;
                items.push({ name: '‚ö° Fast Lane / Priority Service (+30%)', price: fastLaneCost });
            }
            
            // Render itemized list
            const listContent = document.getElementById('itemizedListContent');
            if (items.length === 1 && items[0].name.includes('Base Video Edit')) {
                listContent.innerHTML = '<div class="no-items">Select services above to see itemized pricing</div>';
            } else {
                listContent.innerHTML = items.map(item => `
                    <div class="item">
                        <span class="item-name">${item.name}</span>
                        <span class="item-price">$${Math.round(item.price).toLocaleString()}</span>
                    </div>
                `).join('');
            }
        }
        
        // Calculate price
        function calculatePrice() {
            let basePrice = 0;
            
            const timelineEditingEnabled = document.getElementById('timelineEditingEnabled').checked;
            const duration = timelineEditingEnabled ? (parseFloat(document.getElementById('duration').value) || 0) : 0;
            
            // Check if any post-production services are selected
            const hasPostProduction = duration > 0 || 
                document.getElementById('basicColor').checked ||
                document.getElementById('advancedColor').checked ||
                document.getElementById('fxWork').checked ||
                document.getElementById('motionGraphics').checked ||
                document.getElementById('audioMixing').checked ||
                document.getElementById('soundDesign').checked ||
                document.getElementById('musicComposition').checked ||
                document.getElementById('voiceover').checked;
            
            // Filming services
            const filmingRateType = document.getElementById('filmingRateType').value;
            const isFilming = filmingRateType !== 'none';
            const isFileTransferOnly = isFilming && !hasPostProduction;
            
            if (filmingRateType !== 'none') {
                const filmingDuration = parseFloat(document.getElementById('filmingDuration').value) || 0;
                const filmingLocation = document.getElementById('filmingLocation').value;
                
                if (filmingRateType === 'daily') {
                    const dailyRates = {
                        studio: 1000,
                        indoor: 1200,
                        outdoor: 1400,
                        multiple: 1600
                    };
                    basePrice += filmingDuration * dailyRates[filmingLocation];
                } else if (filmingRateType === 'hourly') {
                    const hourlyRates = {
                        studio: 150,
                        indoor: 180,
                        outdoor: 200,
                        multiple: 220
                    };
                    basePrice += filmingDuration * hourlyRates[filmingLocation];
                }
                
                // File transfer fee (only if no editing)
                if (isFileTransferOnly) {
                    const rawFootageMinutes = parseFloat(document.getElementById('rawFootageMinutes').value) || 0;
                    const estimatedGB = rawFootageMinutes * 4; // avg 4GB per minute
                    const transferFee = 25 + (Math.floor(estimatedGB / 100) * 25);
                    basePrice += transferFee;
                }
            }
            
            // Base edit (only if duration > 0) with tiered pricing
            if (duration > 0) {
                if (duration < 1) {
                    basePrice += duration * 100;  // Under 1 min: $100/min
                } else if (duration <= 5) {
                    basePrice += duration * 60;   // 1-5 min: $60/min
                } else {
                    basePrice += duration * 40;   // 5+ min: $40/min
                }
            }
            
            // Post-production add-ons
            if (document.getElementById('basicColor').checked) basePrice += 200;
            if (document.getElementById('advancedColor').checked) basePrice += 500;
            if (document.getElementById('fxWork').checked) basePrice += 400;
            if (document.getElementById('audioMixing').checked) basePrice += duration * 45;
            if (document.getElementById('soundDesign').checked) basePrice += 150;
            
            // Music composition
            if (document.getElementById('musicComposition').checked) {
                const musicType = document.getElementById('musicType').value;
                basePrice += musicType === 'jingle' ? 500 : 200;
            }
            
            // Voiceover - adjusted to video duration
            if (document.getElementById('voiceover').checked) {
                const voiceoverCoverage = document.getElementById('voiceoverCoverage').value;
                if (voiceoverCoverage === 'full') {
                    basePrice += duration * 300;
                } else {
                    basePrice += (duration * 0.5) * 300;
                }
            }
            
            // Motion graphics
            if (document.getElementById('motionGraphics').checked) {
                const graphicsDuration = parseInt(document.getElementById('graphicsDuration').value) || 0;
                const graphicsComplexity = document.getElementById('graphicsComplexity').value;
                const rates = { simple: 15, moderate: 35, complex: 65 };
                basePrice += graphicsDuration * rates[graphicsComplexity];
            }
            
            // Fast Lane / Priority Service (+30%)
            if (document.getElementById('fastLane').checked) {
                basePrice = basePrice * 1.30;
            }
            
            // Round and display
            const finalPrice = basePrice >= 50 ? Math.round(basePrice / 50) * 50 : Math.round(basePrice);
            document.getElementById('totalPrice').textContent = finalPrice.toLocaleString();
        }
        
        // Initialize
        calculatePrice();
        updateItemizedList();
        
        // Auto-update on changes
        document.getElementById('quoteForm').addEventListener('change', function() {
            calculatePrice();
            updateItemizedList();
        });
        
        document.getElementById('quoteForm').addEventListener('input', function() {
            calculatePrice();
            updateItemizedList();
        });
        
        // Handle form submission
        document.getElementById('quoteForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const successMsg = document.getElementById('successMessage');
            const errorMsg = document.getElementById('errorMessage');
            
            // Hide messages
            successMsg.classList.remove('show');
            errorMsg.classList.remove('show');
            
            // Validate
            const clientName = document.getElementById('clientName').value.trim();
            const clientEmail = document.getElementById('clientEmail').value.trim();
            const projectName = document.getElementById('projectName').value.trim();
            
            if (!clientName || !clientEmail || !projectName) {
                document.getElementById('errorText').textContent = 'Please fill in all required fields (*)';
                errorMsg.classList.add('show');
                return;
            }
            
            // Disable button
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<div class="loading-spinner"></div> Submitting...';
            
            try {
                // Generate invoice number: YYMMDD-HHMM
                const now = new Date();
                const year = String(now.getFullYear()).slice(-2);
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const invoiceNumber = `${year}${month}${day}-${hours}${minutes}`;
                
                // Build description for notes field
                const services = [];
                
                // Check if any post-production services are selected
                const timelineEditingEnabled = document.getElementById('timelineEditingEnabled').checked;
                const videoDuration = timelineEditingEnabled ? (parseFloat(document.getElementById('duration').value) || 0) : 0;
                const hasPostProduction = videoDuration > 0 || 
                    document.getElementById('basicColor').checked ||
                    document.getElementById('advancedColor').checked ||
                    document.getElementById('fxWork').checked ||
                    document.getElementById('motionGraphics').checked ||
                    document.getElementById('audioMixing').checked ||
                    document.getElementById('soundDesign').checked ||
                    document.getElementById('musicComposition').checked ||
                    document.getElementById('voiceover').checked;
                
                // Filming info
                const filmingRateType = document.getElementById('filmingRateType').value;
                const isFileTransferOnly = filmingRateType !== 'none' && !hasPostProduction;
                
                if (filmingRateType === 'none') {
                    services.push('Filming: Post-Production Only (Client providing footage)');
                } else if (filmingRateType === 'daily') {
                    const filmingDuration = document.getElementById('filmingDuration').value;
                    services.push(`Filming: ${filmingDuration} day(s) - ${document.getElementById('filmingLocation').value} location`);
                } else {
                    services.push(`Filming: ${document.getElementById('filmingDuration').value} hours - ${document.getElementById('filmingLocation').value} location`);
                }
                
                // Add file transfer info if no editing
                if (isFileTransferOnly) {
                    const rawFootageMinutes = document.getElementById('rawFootageMinutes').value;
                    const estimatedGB = rawFootageMinutes * 4;
                    services.push(`File Transfer: ~${Math.round(estimatedGB)}GB raw footage (filming only, no editing)`);
                }
                
                // Post-production services
                if (document.getElementById('basicColor').checked) services.push('Basic Color Correction');
                if (document.getElementById('advancedColor').checked) services.push('Advanced Color Grading');
                if (document.getElementById('fxWork').checked) services.push('Visual Effects');
                if (document.getElementById('motionGraphics').checked) services.push(`Motion Graphics (${document.getElementById('graphicsDuration').value}s, ${document.getElementById('graphicsComplexity').value})`);
                if (document.getElementById('audioMixing').checked) services.push('Audio Mixing/Mastering');
                if (document.getElementById('soundDesign').checked) services.push('Sound Design/SFX');
                if (document.getElementById('musicComposition').checked) {
                    const musicType = document.getElementById('musicType').value;
                    services.push(musicType === 'jingle' ? 'Music Composition - Jingle' : 'Music Composition - Music Bed');
                }
                if (document.getElementById('voiceover').checked) {
                    const coverage = document.getElementById('voiceoverCoverage').value;
                    services.push(coverage === 'full' ? 'Voiceover/Narration - Full Coverage' : 'Voiceover/Narration - Partial Coverage');
                }
                
                // Fast Lane status
                const isFastLane = document.getElementById('fastLane').checked;
                const fastLaneText = isFastLane ? '\n\n‚ö° FAST LANE / PRIORITY SERVICE (+30%)\nRUSH DELIVERY - Move to front of production line' : '';
                
                const description = [
                    document.getElementById('projectDescription').value || '',
                    '',
                    'Services Requested:',
                    ...services.map(s => `‚Ä¢ ${s}`),
                    `‚Ä¢ Video Duration: ${document.getElementById('duration').value} minutes`,
                    fastLaneText,
                    '',
                    `Client Email: ${clientEmail}`
                ].filter(Boolean).join('\n');
                
                // Gather data in dashboard format
                const quoteData = {
                    task: projectName,
                    clientName: clientName,
                    person: '',
                    status: 'Not started',
                    priority: isFastLane ? 'High' : 'Standard',
                    requestDate: new Date().toISOString().split('T')[0],
                    dueDate: '',
                    actualWorkHours: '0',
                    workHours: '0',
                    notes: description,
                    invoiceNumber: invoiceNumber,
                    totalPrice: document.getElementById('totalPrice').textContent.replace(/,/g, ''),
                    timeline: '',
                    source: 'Client Quote Form',
                    submittedAt: firebase.database.ServerValue.TIMESTAMP
                };
                
                // Submit to Firebase
                if (!database) {
                    throw new Error('Firebase not initialized');
                }
                
                const requestRef = database.ref('requests').push();
                await requestRef.set(quoteData);
                
                // Success
                successMsg.classList.add('show');
                submitBtn.innerHTML = '‚úì Submitted!';
                
                // Reset form after delay
                setTimeout(() => {
                    if (confirm('Submit another quote request?')) {
                        location.reload();
                    }
                }, 3000);
                
            } catch (error) {
                console.error('Submission error:', error);
                document.getElementById('errorText').textContent = `Error: ${error.message}. Please check your internet connection.`;
                errorMsg.classList.add('show');
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'Submit Request';
            }
        });
    </script>
</body>
</html>
